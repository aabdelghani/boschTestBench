<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>testBenchdoc: Arduino PWM Generation Using Timer1 with Selectable Frequencies</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">testBenchdoc
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Arduino PWM Generation Using Timer1 with Selectable Frequencies</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>This Arduino sketch is designed to generate a Pulse Width Modulation (PWM) signal using Timer1 interrupts. It features the ability to select predefined frequencies through preprocessor directives, allowing easy switching between different PWM frequencies. This method provides precise control over PWM signals, which is useful for a variety of applications including LED dimming, motor control, and signal generation.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Hardware Requirements</h1>
<ul>
<li>Arduino Uno or similar AVR-based board</li>
<li>LED</li>
<li>220 Ohm resistor</li>
<li>Breadboard and jumper wires</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Software Requirements</h1>
<ul>
<li>Arduino IDE for uploading the sketch to the Arduino board</li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
Configuration</h1>
<ul>
<li><b>PWM Pin</b>: The sketch uses digital pin 9 on the Arduino for PWM output. This pin is compatible with Timer1.</li>
<li><b>Predefined Frequencies</b>: Frequencies are predefined as macros and can be selected by changing the <code>FREQUENCY</code> definition at the top of the sketch. Current predefined frequencies include 1kHz, 2kHz, and 5kHz.</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
How to Use</h1>
<ol type="1">
<li><b>Connect the Hardware</b>: Connect the LED and resistor in series between pin 9 and GND on the Arduino.</li>
<li><b>Set the Desired Frequency</b>: Open the sketch in the Arduino IDE and set the desired frequency by changing the <code>#define FREQUENCY</code> line to one of the predefined frequencies (e.g., <code>#define FREQUENCY 1kHz</code>).</li>
<li><b>Upload the Sketch</b>: Connect the Arduino to your computer and upload the sketch using the Arduino IDE.</li>
<li><b>Observe the PWM Signal</b>: Once uploaded, the connected LED will show the PWM effect at the selected frequency.</li>
</ol>
<h1><a class="anchor" id="autotoc_md6"></a>
Code Explanation</h1>
<ul>
<li><b>Timer1 Setup</b>: The sketch configures Timer1 in Clear Timer on Compare Match (CTC) mode. The compare match register (OCR1A) value is set based on the selected frequency. A prescaler of 8 is used to scale down the 16MHz clock.</li>
<li><b>Interrupt Service Routine (ISR)</b>: The <code>TIMER1_COMPA_vect</code> ISR toggles the LED pin at each timer compare match, creating the PWM signal.</li>
<li><b>Frequency Selection</b>: Use the <code>#define FREQUENCY</code> directive to select the PWM frequency. The available options are set using individual <code>#define</code> statements for each frequency.</li>
<li><b>Error Handling</b>: If an undefined frequency is selected, the preprocessor generates a compile-time error.</li>
</ul>
<h1><a class="anchor" id="autotoc_md7"></a>
Notes</h1>
<ul>
<li>The frequency values are calculated assuming a 16MHz clock and an 8x prescaler. Adjust these values if using a different clock or prescaler.</li>
<li>This code is intended for Arduino Uno and similar AVR-based boards. Other boards may require adjustments due to different timer configurations.</li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
Limitations</h1>
<ul>
<li>The current setup allows for basic PWM control. For more complex applications, additional modifications might be necessary.</li>
<li>The use of interrupts and timers may interfere with other time-dependent Arduino functions.</li>
</ul>
<h1><a class="anchor" id="autotoc_md9"></a>
Side Note: Setting the Compare Match Register for 1kHz Frequency</h1>
<p>The line in the code <code>// Set compare match register to desired timer count for 1kHz frequency</code> is a crucial part of setting up the Timer1 interrupt in the Arduino. Let's break down this concept for a clearer understanding.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Timer and Compare Match Register</h2>
<p><b>Timer Functionality:</b> In microcontrollers like the Arduino, timers are used for various time-related functions. They can be used for creating delays, measuring time intervals, generating signals, etc. Timers count up (or down) at a specific rate determined by the microcontroller's clock frequency and the timer's prescaler setting.</p>
<p><b>Compare Match Register (OCR1A):</b> The Output Compare Register for Timer1 (OCR1A in this case) is used to set a specific value at which the timer will trigger an action. When the timer's count matches the value in the OCR1A register, an interrupt can be generated (if enabled). This is known as a Compare Match.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Setting Up for 1kHz Frequency</h2>
<p>The Arduino Uno (and similar models) use a 16MHz clock. This is the base frequency from which the timer counts are derived.</p>
<p>The line of code in question sets the OCR1A register to create a specific frequency for the interrupt. In this case, the goal is to achieve a frequency of 1 kHz (1,000 cycles per second).</p>
<p>To calculate the value to load into OCR1A:</p>
<ol type="1">
<li><b>Choose a Prescaler:</b> A prescaler scales down the clock frequency. For instance, a prescaler of 8 will divide the 16MHz clock by 8, resulting in a 2MHz timer clock frequency.</li>
<li><p class="startli"><b>Calculate the Timer Count:</b> The formula to calculate the value to be put into the OCR1A register for a desired frequency is:</p>
<p class="startli">OCR1A = (Timer Clock Frequency / Desired Interrupt Frequency) - 1</p>
</li>
<li><p class="startli"><b>Apply the Formula:</b> For a 1kHz frequency with a 2MHz timer clock (after prescaling by 8), the calculation would be:</p>
<p class="startli">OCR1A = (2,000,000 / 1,000) - 1 = 1999</p>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md12"></a>
What Happens at Runtime</h2>
<p>Each time Timer1 counts to 1999 (starting from 0), the compare match interrupt (<code>TIMER1_COMPA_vect</code>) is triggered. This creates a regular interrupt at a frequency of 1kHz. Inside the ISR (Interrupt Service Routine), you can then implement functionality that needs to run at this frequency, like toggling an LED to create a PWM signal.</p>
<p>In summary, setting the compare match register to the appropriate value based on the timer's clock frequency and desired output frequency is a key step in utilizing timers for precise timing operations in microcontrollers.</p>
<p>This documentation should provide a clear understanding of how the sketch operates and how to use it for generating PWM signals with selectable frequencies. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
